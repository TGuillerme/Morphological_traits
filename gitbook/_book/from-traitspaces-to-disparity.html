<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 From traitspaces to disparity | Traits data in R</title>
  <meta name="description" content="A guide to using morphological trait data in R" />
  <meta name="generator" content="bookdown 0.36 and GitBook 2.6.7" />

  <meta property="og:title" content="3 From traitspaces to disparity | Traits data in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A guide to using morphological trait data in R" />
  <meta name="github-repo" content="TGuillerme/Morphological_traits" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 From traitspaces to disparity | Traits data in R" />
  
  <meta name="twitter:description" content="A guide to using morphological trait data in R" />
  

<meta name="author" content="Thomas Guillerme (t.guillerme@sheffield.ac.uk)" />


<meta name="date" content="2024-08-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="from-observations-to-traitspaces.html"/>
<link rel="next" href="from-disparity-to-macroevolution.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preamble</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#mega-disclaimer"><i class="fa fa-check"></i><b>1.1</b> Mega-disclaimer</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#requirements"><i class="fa fa-check"></i><b>1.2</b> Requirements</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#general-computer-level"><i class="fa fa-check"></i><b>1.2.1</b> General computer level</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#r-level"><i class="fa fa-check"></i><b>1.2.2</b> <code>R</code> level</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#glossary"><i class="fa fa-check"></i><b>1.3</b> Glossary</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#how-does-this-work"><i class="fa fa-check"></i><b>1.4</b> How does this work?</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#use-your-own-data"><i class="fa fa-check"></i><b>1.4.1</b> Use your own data</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#catching-up"><i class="fa fa-check"></i><b>1.4.2</b> Catching up</a></li>
<li class="chapter" data-level="1.4.3" data-path="index.html"><a href="index.html#tinker-time"><i class="fa fa-check"></i><b>1.4.3</b> Tinker time!</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#help-me"><i class="fa fa-check"></i><b>1.5</b> Help me!</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#references"><i class="fa fa-check"></i><b>1.6</b> References</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="from-observations-to-traitspaces.html"><a href="from-observations-to-traitspaces.html"><i class="fa fa-check"></i><b>2</b> From observations to traitspaces</a>
<ul>
<li class="chapter" data-level="2.1" data-path="from-observations-to-traitspaces.html"><a href="from-observations-to-traitspaces.html#morphological-traits"><i class="fa fa-check"></i><b>2.1</b> Morphological traits</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="from-observations-to-traitspaces.html"><a href="from-observations-to-traitspaces.html#morphological-traits-in-the-age-of-molecular-data"><i class="fa fa-check"></i><b>2.1.1</b> Morphological traits in the age of molecular data?</a></li>
<li class="chapter" data-level="2.1.2" data-path="from-observations-to-traitspaces.html"><a href="from-observations-to-traitspaces.html#continuous-trait-data"><i class="fa fa-check"></i><b>2.1.2</b> Continuous trait data</a></li>
<li class="chapter" data-level="2.1.3" data-path="from-observations-to-traitspaces.html"><a href="from-observations-to-traitspaces.html#discrete-trait-data"><i class="fa fa-check"></i><b>2.1.3</b> Discrete trait data</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="from-observations-to-traitspaces.html"><a href="from-observations-to-traitspaces.html#ordinations"><i class="fa fa-check"></i><b>2.2</b> Ordinations</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="from-observations-to-traitspaces.html"><a href="from-observations-to-traitspaces.html#principal-components-analyses-pca"><i class="fa fa-check"></i><b>2.2.1</b> Principal components analyses (PCA)</a></li>
<li class="chapter" data-level="2.2.2" data-path="from-observations-to-traitspaces.html"><a href="from-observations-to-traitspaces.html#principal-coordinates-analysis-pco"><i class="fa fa-check"></i><b>2.2.2</b> Principal coordinates analysis (PCO)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="from-observations-to-traitspaces.html"><a href="from-observations-to-traitspaces.html#estimating-ancestral-traits"><i class="fa fa-check"></i><b>2.3</b> Estimating ancestral traits</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="from-observations-to-traitspaces.html"><a href="from-observations-to-traitspaces.html#reading-trees-into-r"><i class="fa fa-check"></i><b>2.3.1</b> Reading trees into <code>R</code></a></li>
<li class="chapter" data-level="2.3.2" data-path="from-observations-to-traitspaces.html"><a href="from-observations-to-traitspaces.html#estimating-ancestral-traits-1"><i class="fa fa-check"></i><b>2.3.2</b> Estimating ancestral traits</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="from-observations-to-traitspaces.html"><a href="from-observations-to-traitspaces.html#references-1"><i class="fa fa-check"></i><b>2.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="from-traitspaces-to-disparity.html"><a href="from-traitspaces-to-disparity.html"><i class="fa fa-check"></i><b>3</b> From traitspaces to disparity</a>
<ul>
<li class="chapter" data-level="3.1" data-path="from-traitspaces-to-disparity.html"><a href="from-traitspaces-to-disparity.html#measuring-disparity"><i class="fa fa-check"></i><b>3.1</b> Measuring disparity</a></li>
<li class="chapter" data-level="3.2" data-path="from-traitspaces-to-disparity.html"><a href="from-traitspaces-to-disparity.html#the-curse-of-dimensionality"><i class="fa fa-check"></i><b>3.2</b> The curse of dimensionality</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="from-traitspaces-to-disparity.html"><a href="from-traitspaces-to-disparity.html#reducing-the-number-of-dimensions"><i class="fa fa-check"></i><b>3.2.1</b> Reducing the number of dimensions</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="from-traitspaces-to-disparity.html"><a href="from-traitspaces-to-disparity.html#which-disparity-metric-to-use"><i class="fa fa-check"></i><b>3.3</b> Which disparity metric to use?</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="from-traitspaces-to-disparity.html"><a href="from-traitspaces-to-disparity.html#choosing-and-testing-disparity-metrics"><i class="fa fa-check"></i><b>3.3.1</b> Choosing and testing disparity metrics</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="from-traitspaces-to-disparity.html"><a href="from-traitspaces-to-disparity.html#references-2"><i class="fa fa-check"></i><b>3.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="from-disparity-to-macroevolution.html"><a href="from-disparity-to-macroevolution.html"><i class="fa fa-check"></i><b>4</b> From disparity to macroevolution</a>
<ul>
<li class="chapter" data-level="4.1" data-path="from-disparity-to-macroevolution.html"><a href="from-disparity-to-macroevolution.html#testing-hypothesis-with-disparity-data"><i class="fa fa-check"></i><b>4.1</b> Testing hypothesis with disparity data</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="from-disparity-to-macroevolution.html"><a href="from-disparity-to-macroevolution.html#making-subsets"><i class="fa fa-check"></i><b>4.1.1</b> Making subsets</a></li>
<li class="chapter" data-level="4.1.2" data-path="from-disparity-to-macroevolution.html"><a href="from-disparity-to-macroevolution.html#bootstrapping-and-rarefying"><i class="fa fa-check"></i><b>4.1.2</b> Bootstrapping and rarefying</a></li>
<li class="chapter" data-level="4.1.3" data-path="from-disparity-to-macroevolution.html"><a href="from-disparity-to-macroevolution.html#testing-hypotheses-1"><i class="fa fa-check"></i><b>4.1.3</b> Testing hypotheses 1</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="from-disparity-to-macroevolution.html"><a href="from-disparity-to-macroevolution.html#measuring-disparity-through-time"><i class="fa fa-check"></i><b>4.2</b> Measuring disparity through time</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="from-disparity-to-macroevolution.html"><a href="from-disparity-to-macroevolution.html#time-binning"><i class="fa fa-check"></i><b>4.2.1</b> Time binning</a></li>
<li class="chapter" data-level="4.2.2" data-path="from-disparity-to-macroevolution.html"><a href="from-disparity-to-macroevolution.html#time-slicing"><i class="fa fa-check"></i><b>4.2.2</b> Time slicing!</a></li>
<li class="chapter" data-level="4.2.3" data-path="from-disparity-to-macroevolution.html"><a href="from-disparity-to-macroevolution.html#dtt-disparity-through-time"><i class="fa fa-check"></i><b>4.2.3</b> <code>dtt</code>: disparity through time</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="from-disparity-to-macroevolution.html"><a href="from-disparity-to-macroevolution.html#measuring-disparity-with-trees"><i class="fa fa-check"></i><b>4.3</b> Measuring disparity with trees</a></li>
<li class="chapter" data-level="4.4" data-path="from-disparity-to-macroevolution.html"><a href="from-disparity-to-macroevolution.html#telling-disparity-stories"><i class="fa fa-check"></i><b>4.4</b> Telling disparity stories</a></li>
<li class="chapter" data-level="4.5" data-path="from-disparity-to-macroevolution.html"><a href="from-disparity-to-macroevolution.html#references-3"><i class="fa fa-check"></i><b>4.5</b> References</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Traits data in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="from-traitspaces-to-disparity" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> From traitspaces to disparity<a href="from-traitspaces-to-disparity.html#from-traitspaces-to-disparity" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Once you have created your traitspace, you can then measure disparity.
But was is disparity?
It depends.</p>
<p>There are many different definitions, some are more narrow that others but all agree on the same vague idea that disparity is a statistic that summaries a group’s space occupancy.
Basically a measurement of how elements are distributed in space based on their characteristics (e.g. traits) and very often used to compare groups between each other based on that measurement.
For example is disparity higher in group X or Y?
It can be often easily opposed to “taxonomic diversity” (i.e. number of species).
Basically for this workshop we will define disparity as the diversity of traits combinations which can tell us something about the biology of a system.</p>
<p>This definition is not universal among palaeobiologists: for example, some colleagues use a more restricted definition of the term (e.g. in <span class="citation">Hopkins and Gerber (<a href="#ref-hopkins2021morphological" role="doc-biblioref">2021</a>)</span> - not OA; <a href="http://tguillerme.github.io/papers/Hopkins&amp;Gerber-2017-Disparity.pdf">sneaky download from here</a> - I think more inspired by historical definitions).
I use the more broad defintion that we discuss here <span class="citation">Guillerme, Cooper, et al. (<a href="#ref-guillerme2020disparities" role="doc-biblioref">2020</a>)</span> (maybe more inspired by ecology).</p>
<blockquote>
<p>Note that in palaeobiology we call this statistic “disparity”, “morphological disparity” or “trait disparity” but they are all the same concept.
Even more noteworthy, this is a concept that is also routinely used in ecology but often called “trait dissimilarity” or “functional diversity”.
There is a very rich literature on it that I highly recommend to read to learn more about how this concept has been studied globally.
Check out <span class="citation">Petchey and Gaston (<a href="#ref-petchey2006functional" role="doc-biblioref">2006</a>)</span> and <span class="citation">Mammola et al. (<a href="#ref-mammola2021concepts" role="doc-biblioref">2021</a>)</span> as great starting points.</p>
</blockquote>
<div id="measuring-disparity" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Measuring disparity<a href="from-traitspaces-to-disparity.html#measuring-disparity" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>From this broad definition of disparity, there is many many ways to measure it.
With some colleagues, we strongly argue that it should always be measured in regards to a biological question: i.e. measure it the way it will answer <em>your specific question</em>, not just the way other people have done it (<span class="citation">Guillerme, Puttick, et al. (<a href="#ref-moms" role="doc-biblioref">2020</a>)</span>, <span class="citation">Mammola et al. (<a href="#ref-mammola2021concepts" role="doc-biblioref">2021</a>)</span>, <span class="citation">Guillerme, Cardoso, et al. (<a href="#ref-guillerme2024and" role="doc-biblioref">2024</a>)</span>),
But we will see in more details how to do that later.</p>
<p>Let’s use a super simple case where we want to measure the standard deviation in the traitspace as our disparity metric<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.
This could be used for answering a simple question “how spread is the trait combination in our dataset”.</p>
<div class="warning" style="padding:0.1em; background-color:#FFAF70; color:#954200">
<p><strong>CATCHING UP ZONE</strong>: here’s an example of a traitspace made from continuous data.
But please, feel free to use your own!</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="from-traitspaces-to-disparity.html#cb49-1" aria-hidden="true"></a><span class="co">## An inbuilt ordination directly from the dispRity package</span></span>
<span id="cb49-2"><a href="from-traitspaces-to-disparity.html#cb49-2" aria-hidden="true"></a><span class="kw">data</span>(BeckLee_mat50)</span>
<span id="cb49-3"><a href="from-traitspaces-to-disparity.html#cb49-3" aria-hidden="true"></a>my_traitspace &lt;-<span class="st"> </span>BeckLee_mat50</span></code></pre></div>
</div>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="from-traitspaces-to-disparity.html#cb50-1" aria-hidden="true"></a><span class="co">## The basics for measuring standard deviation</span></span>
<span id="cb50-2"><a href="from-traitspaces-to-disparity.html#cb50-2" aria-hidden="true"></a><span class="kw">sd</span>(my_traitspace)</span></code></pre></div>
<pre><code>## [1] 0.2268704</code></pre>
<p>One other way to achieve the exact same results is through the <code>dispRity</code> function from the eponymous package.
This is a bit pointless and cumbersome for now but it will become more obviously useful later on.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="from-traitspaces-to-disparity.html#cb52-1" aria-hidden="true"></a><span class="co">## Same but using the dispRity package</span></span>
<span id="cb52-2"><a href="from-traitspaces-to-disparity.html#cb52-2" aria-hidden="true"></a>my_dispRity &lt;-<span class="st"> </span><span class="kw">dispRity</span>(my_traitspace, <span class="dt">metric =</span> sd)</span>
<span id="cb52-3"><a href="from-traitspaces-to-disparity.html#cb52-3" aria-hidden="true"></a><span class="kw">summary</span>(my_dispRity)</span></code></pre></div>
<pre><code>##   subsets  n   obs
## 1       1 50 0.227</code></pre>
<p>So that’s it! You’ve now measured disparity.
Well done.
We will talk more about what to measure in a bit but first I want to chat about… <strong><em>The multidimensional nightmare</em></strong></p>
</div>
<div id="the-curse-of-dimensionality" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> The curse of dimensionality<a href="from-traitspaces-to-disparity.html#the-curse-of-dimensionality" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://raw.githack.com/TGuillerme/Morphological_traits/main/slides/02.1_dimensionality.pdf">SLIDES: Dimensionality</a></p>
<p>Basically this is a problem you get very easily when you go beyond anything three dimensional.
When increasing the number of dimensions in your dataset things become very quickly intuitive and headache inducing, even after working on it for many years.
Depending on how your brain works, you will have to take some leap of faith here and assume that what you see and understand is not always correct when you pile up a higher number of dimensions!</p>
<div class="warning" style="padding:0.1em; background-color:#65D85F; color:#067800">
<p><strong>TINKER TIMES</strong>: have a think of how the volume of your traitspace will change with the number of dimensions.</p>
<details>
<p><summary>[<strong>Click to visualise what your data is doing</strong>]:
</summary></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="from-traitspaces-to-disparity.html#cb54-1" aria-hidden="true"></a><span class="co">## Measuring the volume for each additional dimensions</span></span>
<span id="cb54-2"><a href="from-traitspaces-to-disparity.html#cb54-2" aria-hidden="true"></a><span class="co">## A placeholder for the loop results</span></span>
<span id="cb54-3"><a href="from-traitspaces-to-disparity.html#cb54-3" aria-hidden="true"></a>volumes &lt;-<span class="st"> </span><span class="kw">numeric</span>()</span>
<span id="cb54-4"><a href="from-traitspaces-to-disparity.html#cb54-4" aria-hidden="true"></a></span>
<span id="cb54-5"><a href="from-traitspaces-to-disparity.html#cb54-5" aria-hidden="true"></a><span class="cf">for</span>(dimension <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw">ncol</span>(my_traitspace)) {</span>
<span id="cb54-6"><a href="from-traitspaces-to-disparity.html#cb54-6" aria-hidden="true"></a>  <span class="co">## Calculating for each number of column the product of ranges</span></span>
<span id="cb54-7"><a href="from-traitspaces-to-disparity.html#cb54-7" aria-hidden="true"></a>  new_volume &lt;-<span class="st"> </span><span class="kw">prod</span>( <span class="co"># the product</span></span>
<span id="cb54-8"><a href="from-traitspaces-to-disparity.html#cb54-8" aria-hidden="true"></a>    <span class="kw">apply</span>(my_traitspace[, <span class="dv">1</span><span class="op">:</span>dimension], <span class="dv">2</span>, <span class="co"># apply a function for the selected columns (2)</span></span>
<span id="cb54-9"><a href="from-traitspaces-to-disparity.html#cb54-9" aria-hidden="true"></a>      <span class="cf">function</span>(x) <span class="kw">diff</span>(<span class="kw">range</span>(x)))) <span class="co">## calculate the difference between the range of the column (max - min)</span></span>
<span id="cb54-10"><a href="from-traitspaces-to-disparity.html#cb54-10" aria-hidden="true"></a>  <span class="co">## Add it to our volume placeholder</span></span>
<span id="cb54-11"><a href="from-traitspaces-to-disparity.html#cb54-11" aria-hidden="true"></a>  volumes &lt;-<span class="st"> </span><span class="kw">c</span>(volumes, new_volume)</span>
<span id="cb54-12"><a href="from-traitspaces-to-disparity.html#cb54-12" aria-hidden="true"></a>}</span>
<span id="cb54-13"><a href="from-traitspaces-to-disparity.html#cb54-13" aria-hidden="true"></a></span>
<span id="cb54-14"><a href="from-traitspaces-to-disparity.html#cb54-14" aria-hidden="true"></a><span class="co">## Plot the volumes per number of dimensions</span></span>
<span id="cb54-15"><a href="from-traitspaces-to-disparity.html#cb54-15" aria-hidden="true"></a><span class="kw">plot</span>(<span class="dt">x =</span> <span class="dv">2</span><span class="op">:</span><span class="kw">ncol</span>(my_traitspace),</span>
<span id="cb54-16"><a href="from-traitspaces-to-disparity.html#cb54-16" aria-hidden="true"></a>     <span class="dt">y =</span> volumes,</span>
<span id="cb54-17"><a href="from-traitspaces-to-disparity.html#cb54-17" aria-hidden="true"></a>     <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, </span>
<span id="cb54-18"><a href="from-traitspaces-to-disparity.html#cb54-18" aria-hidden="true"></a>     <span class="dt">xlab =</span> <span class="st">&quot;number of dimensions&quot;</span>,</span>
<span id="cb54-19"><a href="from-traitspaces-to-disparity.html#cb54-19" aria-hidden="true"></a>     <span class="dt">ylab =</span> <span class="st">&quot;volume&quot;</span>)</span></code></pre></div>
<p><img src="trait_data_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
</details>
</div>
<p>Congratulations, you now know about the curse of multidimensionality!
We can see this <a href="https://observablehq.com/@tophtucker/theres-plenty-of-room-in-the-corners">excellent illustration by Toph Tucker</a> to have a grasp of what is happening here.</p>
<div id="reducing-the-number-of-dimensions" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Reducing the number of dimensions<a href="from-traitspaces-to-disparity.html#reducing-the-number-of-dimensions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="warning" style="padding:0.1em; background-color:#FFAF70; color:#954200">
<p><strong>CATCHING UP ZONE</strong>: loading some example data!</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="from-traitspaces-to-disparity.html#cb55-1" aria-hidden="true"></a><span class="co">## Loading some example data</span></span>
<span id="cb55-2"><a href="from-traitspaces-to-disparity.html#cb55-2" aria-hidden="true"></a><span class="kw">data</span>(demo_data)</span>
<span id="cb55-3"><a href="from-traitspaces-to-disparity.html#cb55-3" aria-hidden="true"></a>traitspace &lt;-<span class="st"> </span>demo_data<span class="op">$</span>hopkins</span></code></pre></div>
</div>
<p>For very large datasets, it can be useful to reduce the number of dimensions to avoid the curse as much as possible.
This is especially the case if you use a PCA to build your traitspace.
Because it ordinates your data per ranking variance, you end up with most variance in the first couple of dimensions.
Often, you can reduce the number of dimensions so you have a cut-off of the <em>n</em> first dimensions that include <em>X</em> percentage of the variance in your traitspace.
Usually this <em>X</em> is 95% or 99%.</p>
<p>One thing to keep in mind though when you do this is that if you have groups in your traitspace (we will see how to do this later), you might want to check whether they are all equally distributed along those axes.
For example, a reduced traitspace with 95% of the total variance does not automatically means a traitspace with at least 95% of the variance for each group.</p>
<p><a href="https://raw.githack.com/TGuillerme/Morphological_traits/main/slides/02.2_select_axes.pdf">SLIDES: The duck axis</a></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="from-traitspaces-to-disparity.html#cb56-1" aria-hidden="true"></a><span class="co">## How many axes are needed</span></span>
<span id="cb56-2"><a href="from-traitspaces-to-disparity.html#cb56-2" aria-hidden="true"></a>axes_selection &lt;-<span class="st"> </span><span class="kw">select.axes</span>(traitspace, <span class="dt">threshold =</span> <span class="fl">0.95</span>)</span>
<span id="cb56-3"><a href="from-traitspaces-to-disparity.html#cb56-3" aria-hidden="true"></a><span class="kw">plot</span>(<span class="kw">select.axes</span>(demo_data<span class="op">$</span>hopkins))</span></code></pre></div>
<p><img src="trait_data_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
</div>
</div>
<div id="which-disparity-metric-to-use" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Which disparity metric to use?<a href="from-traitspaces-to-disparity.html#which-disparity-metric-to-use" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>So which disparity metric should you be using?
It’s very easy: <strong><em>IT DEPENDS</em></strong>.
In the next section we will be looking in more details what kind of analyses we can do with disparity and what kind of questions we can ask with such approach.
But basically, it’s all about tailoring the disparity metric to your own specific question.</p>
<p>We have done some work on which metrics to choose with colleagues (<span class="citation">Guillerme, Puttick, et al. (<a href="#ref-moms" role="doc-biblioref">2020</a>)</span>, <span class="citation">Mammola et al. (<a href="#ref-mammola2021concepts" role="doc-biblioref">2021</a>)</span> - but other great one exist e.g. <span class="citation">Ciampaglio, Kemp, and McShea (<a href="#ref-ciampaglio2001detecting" role="doc-biblioref">2001</a>)</span>, <span class="citation">Petchey and Gaston (<a href="#ref-petchey2006functional" role="doc-biblioref">2006</a>)</span>, <span class="citation">Stewart et al. (<a href="#ref-stewart2023" role="doc-biblioref">2023</a>)</span>).
Usually, most of these consist in comparing the effect of different metrics at capturing the correct pattern or their sensitivity to missing data.
This is very important of course but I think it’s lacking a didactic aspect that would help people with no idea what to measure on how to measure.
We discuss this in this preprint <span class="citation">Guillerme, Cardoso, et al. (<a href="#ref-guillerme2024and" role="doc-biblioref">2024</a>)</span>.</p>
<p>Basically we believe that for choosing a metric, rather than starting with a metric’s property, it might be easier to start with the question at hand.
You can separate part of your statistical research into three components:</p>
<ul>
<li>The <em>mechanism</em>: that is the biological question at hand and usually has the word <em>“why”</em> in it. For example: “why do mass extinction change the disparity of the groups that survive the mass extinction?”. The <em>why</em> here is the <em>mechanism</em> by which disparity can change in groups due to mass extinctions (i.e. some biology).</li>
<li>The <em>process</em>: this is the dynamic change that makes your question interesting and usually has the word <em>“how”</em> in it. For example: “how does disparity change before and after the mass extinction?”. The <em>how</em> here is the <em>process</em> by which disparity changes through time. This is not especially a biological question (although it ultimately will be) because you can just ask yourself <em>how</em> without asking <em>why</em> (even though that might make it harder to get your paper accepted or your project funded ;)).</li>
<li>The <em>pattern</em>: this is the actual change involved in the process and usually has the work <em>“what”</em> in it. For example what is changing before and after the extinction event? This is effectively the statistic that will allow you to look at the process and understand the mechanism. Basically it’s the statistic, value or… disparity!</li>
</ul>
<p>So once you have your mechanism and process in mind you can choose your metric.</p>
<p><a href="https://raw.githack.com/TGuillerme/Morphological_traits/main/slides/02.3_what_how_why.pdf">SLIDES: What? How? Why?</a></p>
<div id="choosing-and-testing-disparity-metrics" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Choosing and testing disparity metrics<a href="from-traitspaces-to-disparity.html#choosing-and-testing-disparity-metrics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><a href="https://raw.githack.com/TGuillerme/Morphological_traits/main/slides/02.4_different_metrics.pdf">SLIDES: Types of metrics</a></p>
<p>You can use the <code>dispRity</code> and <code>moms</code> pipeline to test your metric.</p>
<p><a href="https://tguillerme.shinyapps.io/moms/"><code>moms</code></a>.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="from-traitspaces-to-disparity.html#cb57-1" aria-hidden="true"></a><span class="co">## Testing the sum of variance</span></span>
<span id="cb57-2"><a href="from-traitspaces-to-disparity.html#cb57-2" aria-hidden="true"></a>my_test &lt;-<span class="st"> </span><span class="kw">test.metric</span>(my_traitspace, <span class="dt">metric =</span> <span class="kw">c</span>(sum,variances), <span class="dt">shifts =</span> <span class="kw">c</span>(<span class="st">&quot;size&quot;</span>, <span class="st">&quot;random&quot;</span>))</span>
<span id="cb57-3"><a href="from-traitspaces-to-disparity.html#cb57-3" aria-hidden="true"></a><span class="kw">plot</span>(my_test)</span></code></pre></div>
<p><img src="trait_data_files/figure-html/unnamed-chunk-37-1.png" width="576" /></p>
<div class="warning" style="padding:0.1em; background-color:#65D85F; color:#067800">
<p><strong>TINKER TIMES</strong>: Have a go and test multiple metrics and multiple processes to see which one would work better!</p>
<details>
<p><summary>[<strong>Click to expand the solution</strong>]:
</summary></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="from-traitspaces-to-disparity.html#cb58-1" aria-hidden="true"></a><span class="co">## Does the sum of variance captures changes in size or in position</span></span>
<span id="cb58-2"><a href="from-traitspaces-to-disparity.html#cb58-2" aria-hidden="true"></a>my_test1 &lt;-<span class="st"> </span><span class="kw">test.metric</span>(my_traitspace, <span class="dt">metric =</span> <span class="kw">c</span>(sum,variances), <span class="dt">shifts =</span> <span class="kw">c</span>(<span class="st">&quot;size&quot;</span>, <span class="st">&quot;position&quot;</span>, <span class="st">&quot;random&quot;</span>))</span>
<span id="cb58-3"><a href="from-traitspaces-to-disparity.html#cb58-3" aria-hidden="true"></a><span class="co">## What about the sum of ranges?</span></span>
<span id="cb58-4"><a href="from-traitspaces-to-disparity.html#cb58-4" aria-hidden="true"></a>my_test2 &lt;-<span class="st"> </span><span class="kw">test.metric</span>(my_traitspace, <span class="dt">metric =</span> <span class="kw">c</span>(sum,ranges), <span class="dt">shifts =</span> <span class="kw">c</span>(<span class="st">&quot;size&quot;</span>, <span class="st">&quot;position&quot;</span>, <span class="st">&quot;random&quot;</span>))</span></code></pre></div>
</details>
</div>
</div>
</div>
<div id="references-2" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> References<a href="from-traitspaces-to-disparity.html#references-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>

<pre><code>## Loading required package: phytools</code></pre>
<pre><code>## Loading required package: maps</code></pre>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references hanging-indent">
<div id="ref-ciampaglio2001detecting">
<p>Ciampaglio, Charles N, Matthieu Kemp, and Daniel W McShea. 2001. “Detecting Changes in Morphospace Occupation Patterns in the Fossil Record: Characterization and Analysis of Measures of Disparity.” <em>Paleobiology</em> 27 (4): 695–715.</p>
</div>
<div id="ref-guillerme2024and">
<p>Guillerme, Thomas, Pedro Cardoso, Maria Wagner Jørgensen, Stefano Mammola, and Thomas J Matthews. 2024. “The What, How and Why of Trait-Based Analyses in Ecology.” <em>bioRxiv</em>, 2024–06.</p>
</div>
<div id="ref-guillerme2020disparities">
<p>Guillerme, Thomas, Natalie Cooper, Stephen L Brusatte, Katie E Davis, Andrew L Jackson, Sylvain Gerber, Anjali Goswami, et al. 2020. “Disparities in the Analysis of Morphological Disparity.” <em>Biology Letters</em> 16 (7): 20200199.</p>
</div>
<div id="ref-moms">
<p>Guillerme, Thomas, Mark N Puttick, Ariel E Marcy, and Vera Weisbecker. 2020. “Shifting Spaces: Which Disparity or Dissimilarity Measurement Best Summarize Occupancy in Multidimensional Spaces?” <em>Ecology and Evolution</em> 10 (14): 7261–75.</p>
</div>
<div id="ref-hopkins2021morphological">
<p>Hopkins, Melanie J, and Sylvain Gerber. 2021. “Morphological Disparity.” <em>Evolutionary Developmental Biology: A Reference Guide</em>, 965–76.</p>
</div>
<div id="ref-mammola2021concepts">
<p>Mammola, Stefano, Carlos P Carmona, Thomas Guillerme, and Pedro Cardoso. 2021. “Concepts and Applications in Functional Diversity.” <em>Functional Ecology</em> 35 (9): 1869–85.</p>
</div>
<div id="ref-petchey2006functional">
<p>Petchey, Owen L, and Kevin J Gaston. 2006. “Functional Diversity: Back to Basics and Looking Forward.” <em>Ecology Letters</em> 9 (6): 741–58.</p>
</div>
<div id="ref-stewart2023">
<p>Stewart, Kerry, Carlos P Carmona, Chris Clements, Chris Venditti, Joseph A Tobias, and Manuela González-Suárez. 2023. “Functional Diversity Metrics Can Perform Well with Highly Incomplete Data Sets.” <em>Methods in Ecology and Evolution</em> 14 (11): 2856–72.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p><strong>Disparity metric or disparity index?</strong>. You might encounter both terms which designate the same thing: a disparity statistic. Some people prefer using the term “index” because a “metric” has a specific definition in mathematics (i.e. not all indices or statistics are metrics). Some other people prefer using the term “metric” (e.g. myself) because the term “index” has a specific definition in informatics (i.e. an index is a numbered element in a list). Tomato tomato.<a href="from-traitspaces-to-disparity.html#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="from-observations-to-traitspaces.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="from-disparity-to-macroevolution.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
